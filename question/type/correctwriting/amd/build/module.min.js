define(["jquery","core/yui"],function(a,b){const c=function(){this.hidden_descriptions=[],this.answer_count=0,this.lexerurl=0,this.lasttimefired={},this.require_answer_message="",this.hide_descriptions=function(b){this.hidden_descriptions=b,a(document).ready(function(){var b,c,d,e=M.question_type_correctwriting.form;for(b=0;b<e.hidden_descriptions.length;b++)c=e.hidden_descriptions[b],d=a("#fitem_id_lexemedescriptions_"+c),d.css("display","none"),d.prev().css("display","none")})},this.hide_description_field=function(b){var c="#fitem_id_lexemedescriptions_"+b,d=a(c);d.prev().css("display","none"),d.css("display","none")},this.init_require_answer_message=function(a){this.require_answer_message=a},this.init_text_input=function(b,c){this.answer_count=b,this.lexerurl=c;var d=a("label[for*=id_lexemedescriptions_] textarea");d.css("width","100%"),d.css("margin-top","5px"),d.css("background-color","#fff"),d.addClass("form-control");var e=function(){var b=(new Date).getTime(),c=a(this).attr("name").match("(answer|fraction)\\[([0-9]+)\\]"),d=c[2],e=parseFloat(a("input[name=hintgradeborder]").val()),f=a("textarea[name='answer["+d+"]']"),g=f.val(),h=a("#fitem_id_lexemedescriptions_"+d),i=parseFloat(a("select[name='fraction["+d+"]']").val()),j=!1;isNaN(e)||(0==g.length||i<e?(0==g.length&&i>=e?M.question_type_correctwriting.form.toggle_error_span(f[0],M.question_type_correctwriting.form.require_answer_message):M.question_type_correctwriting.form.toggle_error_span(f[0],""),h.css("display","none"),h.prev().css("display","none")):(h.css("display","block"),h.prev().css("display","block"),j=!0)),b-M.question_type_correctwriting.form.lasttimefired[d]>50&&(M.question_type_correctwriting.form.lasttimefired[d]=b,j&&M.question_type_correctwriting.form.run_request(g,d))},f=function(){var b,c,d,e=parseFloat(a("input[name=hintgradeborder]").val());if(!isNaN(e))for(var f=0;f<M.question_type_correctwriting.form.answer_count;f++)d=a("textarea[name='answer["+f+"]']").val(),b=parseFloat(a("select[name='fraction["+f+"]']").val()),c=a("#fitem_id_lexemedescriptions_"+f),0==d.length||b<e?(c.css("display","none"),c.prev().css("display","none")):(c.css("display","block"),c.prev().css("display","block"),M.question_type_correctwriting.form.run_request(d,f))},g=function(){for(var b=0;b<this.answer_count;b++)M.question_type_correctwriting.form.lasttimefired[b]=(new Date).getTime(),a("textarea[name='answer["+b+"]']").keyup(e),a("select[name='fraction["+b+"]']").change(e),a("input[name=hintgradeborder]").focusout(f),a("select[name=isenumanalyzerenabled]").change(f),a("select[name=issyntaxanalyzerenabled]").change(f),a("select[name=allowinvalidsyntaxanswers]").change(f)}.bind(this);a(document).ready(g)},this.toggle_error_span=function(b,c){var d,e=b.parentNode,f=a(b).attr("name"),g=f.replace(/\[/g,"\\[").replace(/\]/g,"\\]");if(void 0==e||void 0==b.name)return!0;var h=a.trim(c);if(0!=h.length){if(d=a("#id_error_"+g),0==d.length){var i='<span class="error" id="id_error_'+f+'"></span>';a(i).insertBefore(a(b.parentNode.firstChild)),d=a("#id_error_"+g),d.attr("TabIndex",0)}if(d.html(c),0==a(e).hasClass("error")){var j=a(d[0].nextSibling);a('<br class="error" id="id_error_break_'+f+'">').insertBefore(j),a(e).addClass("error")}return!1}return a("#id_error_"+g).remove(),a("#id_error_break_"+g).remove(),a(e).removeClass("error"),!0},this.run_request=function(c,d){var e=a("label[for=id_lexemedescriptions_"+d+"] textarea"),f=a("#id_lexemedescriptions_"+d),g=a("#id_langid").val(),h=a("textarea[name='answer["+d+"]']"),i=a("select[name='isenumanalyzerenabled']").val(),j=0,k=a("select[name='issyntaxanalyzerenabled']");0!=k.length&&(j=k.val());var l=a("select[name='allowinvalidsyntaxanswers']").val(),m=this;a.ajax({url:this.lexerurl,type:"POST",data:{scannedtext:c,lang:g,isenumanalyzerenabled:i,issyntaxanalyzerenabled:j,allowinvalidsyntaxanswers:l},dataType:"json",success:function(a){if("object"==typeof a&&null!=a){if(!("tokens"in a))return void b.use("moodle-core-notification-ajaxexception",function(){return new M.core.ajaxException({name:"Error when fetching AJAX request",error:JSON.stringify(a),reproductionlink:window.location.href})});for(var c=0,d=0;d<a.tokens.length;d++)c=Math.max(c,a.tokens[d].length);m.toggle_error_span(h[0],""),0!=a.errors.length&&m.toggle_error_span(h[0],a.errors),e.removeAttr("style"),e.css("width","100%"),e.css("margin-top","5px"),e.css("background-color","#fff"),e.attr("rows",a.tokens.length),e.attr("cols",c),e.val(a.tokens.join("\n")),f.attr("rows",a.tokens.length)}}})}};return M.question_type_correctwriting=M.question_type_correctwriting||{},M.question_type_correctwriting.form=M.question_type_correctwriting.form||new c,M.question_type_correctwriting.form});